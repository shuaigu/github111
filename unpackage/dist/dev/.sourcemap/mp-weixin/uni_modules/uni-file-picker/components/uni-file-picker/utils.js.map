{"version":3,"file":"utils.js","sources":["uni_modules/uni-file-picker/components/uni-file-picker/utils.js"],"sourcesContent":["/**\n * 获取文件名和后缀\n * @param {String} name\n */\nexport const get_file_ext = (name) => {\n\tconst last_len = name.lastIndexOf('.')\n\tconst len = name.length\n\treturn {\n\t\tname: name.substring(0, last_len),\n\t\text: name.substring(last_len + 1, len)\n\t}\n}\n\n/**\n * 获取扩展名\n * @param {Array} fileExtname\n */\nexport const get_extname = (fileExtname) => {\n\tif (!Array.isArray(fileExtname)) {\n\t\tlet extname = fileExtname.replace(/(\\[|\\])/g, '')\n\t\treturn extname.split(',')\n\t} else {\n\t\treturn fileExtname\n\t}\n\treturn []\n}\n\n/**\n * 获取文件和检测是否可选\n */\nexport const get_files_and_is_max = (res, _extname) => {\n\tlet filePaths = []\n\tlet files = []\n\tif(!_extname || _extname.length === 0){\n\t\treturn {\n\t\t\tfilePaths,\n\t\t\tfiles\n\t\t}\n\t}\n\tres.tempFiles.forEach(v => {\n\t\tlet fileFullName = get_file_ext(v.name)\n\t\tconst extname = fileFullName.ext.toLowerCase()\n\t\tif (_extname.indexOf(extname) !== -1) {\n\t\t\tfiles.push(v)\n\t\t\tfilePaths.push(v.path)\n\t\t}\n\t})\n\tif (files.length !== res.tempFiles.length) {\n\t\tuni.showToast({\n\t\t\ttitle: `当前选择了${res.tempFiles.length}个文件 ，${res.tempFiles.length - files.length} 个文件格式不正确`,\n\t\t\ticon: 'none',\n\t\t\tduration: 5000\n\t\t})\n\t}\n\n\treturn {\n\t\tfilePaths,\n\t\tfiles\n\t}\n}\n\n\n/**\n * 获取图片信息\n * @param {Object} filepath\n */\nexport const get_file_info = (filepath) => {\n\treturn new Promise((resolve, reject) => {\n\t\tuni.getImageInfo({\n\t\t\tsrc: filepath,\n\t\t\tsuccess(res) {\n\t\t\t\tresolve(res)\n\t\t\t},\n\t\t\tfail(err) {\n\t\t\t\treject(err)\n\t\t\t}\n\t\t})\n\t})\n}\n/**\n * 获取封装数据\n */\nexport const get_file_data = async (files, type = 'image') => {\n\t// 最终需要上传数据库的数据\n\tlet fileFullName = get_file_ext(files.name)\n\tconst extname = fileFullName.ext.toLowerCase()\n\tlet filedata = {\n\t\tname: files.name,\n\t\tuuid: files.uuid,\n\t\textname: extname || '',\n\t\tcloudPath: files.cloudPath,\n\t\tfileType: files.fileType,\n\t\tthumbTempFilePath: files.thumbTempFilePath,\n\t\turl: files.path || files.path,\n\t\tsize: files.size, //单位是字节\n\t\timage: {},\n\t\tpath: files.path,\n\t\tvideo: {}\n\t}\n\tif (type === 'image') {\n\t\tconst imageinfo = await get_file_info(files.path)\n\t\tdelete filedata.video\n\t\tfiledata.image.width = imageinfo.width\n\t\tfiledata.image.height = imageinfo.height\n\t\tfiledata.image.location = imageinfo.path\n\t} else {\n\t\tdelete filedata.image\n\t}\n\treturn filedata\n}\n"],"names":["uni"],"mappings":";;AAIO,MAAM,eAAe,CAAC,SAAS;AACrC,QAAM,WAAW,KAAK,YAAY,GAAG;AACrC,QAAM,MAAM,KAAK;AACjB,SAAO;AAAA,IACN,MAAM,KAAK,UAAU,GAAG,QAAQ;AAAA,IAChC,KAAK,KAAK,UAAU,WAAW,GAAG,GAAG;AAAA,EACrC;AACF;AAMY,MAAC,cAAc,CAAC,gBAAgB;AAC3C,MAAI,CAAC,MAAM,QAAQ,WAAW,GAAG;AAChC,QAAI,UAAU,YAAY,QAAQ,YAAY,EAAE;AAChD,WAAO,QAAQ,MAAM,GAAG;AAAA,EAC1B,OAAQ;AACN,WAAO;AAAA,EACP;AAEF;AAKY,MAAC,uBAAuB,CAAC,KAAK,aAAa;AACtD,MAAI,YAAY,CAAE;AAClB,MAAI,QAAQ,CAAE;AACd,MAAG,CAAC,YAAY,SAAS,WAAW,GAAE;AACrC,WAAO;AAAA,MACN;AAAA,MACA;AAAA,IACA;AAAA,EACD;AACD,MAAI,UAAU,QAAQ,OAAK;AAC1B,QAAI,eAAe,aAAa,EAAE,IAAI;AACtC,UAAM,UAAU,aAAa,IAAI,YAAa;AAC9C,QAAI,SAAS,QAAQ,OAAO,MAAM,IAAI;AACrC,YAAM,KAAK,CAAC;AACZ,gBAAU,KAAK,EAAE,IAAI;AAAA,IACrB;AAAA,EACH,CAAE;AACD,MAAI,MAAM,WAAW,IAAI,UAAU,QAAQ;AAC1CA,kBAAAA,MAAI,UAAU;AAAA,MACb,OAAO,QAAQ,IAAI,UAAU,MAAM,QAAQ,IAAI,UAAU,SAAS,MAAM,MAAM;AAAA,MAC9E,MAAM;AAAA,MACN,UAAU;AAAA,IACb,CAAG;AAAA,EACD;AAED,SAAO;AAAA,IACN;AAAA,IACA;AAAA,EACA;AACF;AAOO,MAAM,gBAAgB,CAAC,aAAa;AAC1C,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCA,kBAAAA,MAAI,aAAa;AAAA,MAChB,KAAK;AAAA,MACL,QAAQ,KAAK;AACZ,gBAAQ,GAAG;AAAA,MACX;AAAA,MACD,KAAK,KAAK;AACT,eAAO,GAAG;AAAA,MACV;AAAA,IACJ,CAAG;AAAA,EACH,CAAE;AACF;AAIY,MAAC,gBAAgB,OAAO,OAAO,OAAO,YAAY;AAE7D,MAAI,eAAe,aAAa,MAAM,IAAI;AAC1C,QAAM,UAAU,aAAa,IAAI,YAAa;AAC9C,MAAI,WAAW;AAAA,IACd,MAAM,MAAM;AAAA,IACZ,MAAM,MAAM;AAAA,IACZ,SAAS,WAAW;AAAA,IACpB,WAAW,MAAM;AAAA,IACjB,UAAU,MAAM;AAAA,IAChB,mBAAmB,MAAM;AAAA,IACzB,KAAK,MAAM,QAAQ,MAAM;AAAA,IACzB,MAAM,MAAM;AAAA;AAAA,IACZ,OAAO,CAAE;AAAA,IACT,MAAM,MAAM;AAAA,IACZ,OAAO,CAAE;AAAA,EACT;AACD,MAAI,SAAS,SAAS;AACrB,UAAM,YAAY,MAAM,cAAc,MAAM,IAAI;AAChD,WAAO,SAAS;AAChB,aAAS,MAAM,QAAQ,UAAU;AACjC,aAAS,MAAM,SAAS,UAAU;AAClC,aAAS,MAAM,WAAW,UAAU;AAAA,EACtC,OAAQ;AACN,WAAO,SAAS;AAAA,EAChB;AACD,SAAO;AACR;;;;"}
{"version":3,"file":"feedBack.js","sources":["subPages/feedBack/feedBack.vue","../../软件/HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c3ViUGFnZXNcZmVlZEJhY2tcZmVlZEJhY2sudnVl"],"sourcesContent":["<script setup>\n\timport { ref } from 'vue';\n\timport { useUserInfoStore } from '@/store/user.js'\n\timport { testLogin } from '@/utils/isLogin';\n\n\t// 反馈内容\n\tconst feedbackContent = ref( '' )\n\t// 图片数据\n\tconst imageValue = ref( [ ] )\n\t// 反馈类型\n\tconst selectedType = ref( '功能建议' )\n\t// 联系方式\n\tconst contactInfo = ref( '' )\n\t// 用户store\n\tconst userStore = useUserInfoStore( )\n\t// 反馈类型列表\n\tconst feedbackTypes = [ '功能建议', '界面设计', '性能问题', '其他' ]\n\t// 是否正在提交\n\tconst isSubmitting = ref( false )\n\n\t// 选择反馈类型\n\tconst selectType = ( type ) => {\n\t\tselectedType.value = type\n\t}\n\n\t// 上传成功回调\n\tconst success = ( e ) => {\n\t\tconst { tempFiles } = e\n\t\timageValue.value = tempFiles\n\t\tuni.showToast( {\n\t\t\ttitle: '上传成功',\n\t\t\ticon: 'success'\n\t\t} )\n\t}\n\n\t// 上传失败回调\n\tconst fail = ( e ) => {\n\t\tconsole.error( '上传失败:', e )\n\t\tuni.showToast( {\n\t\t\ttitle: '上传失败',\n\t\t\ticon: 'error'\n\t\t} )\n\t}\n\n\t// 提交反馈\n\tconst submitFeedback = async ( ) => {\n\t\t// 登录检查\n\t\tif ( !userStore.userInfo.isLogin ) {\n\t\t\treturn testLogin( )\n\t\t}\n\n\t\t// 防止重复提交\n\t\tif ( isSubmitting.value ) return\n\n\t\t// 内容验证\n\t\tif ( feedbackContent.value.length < 10 ) {\n\t\t\treturn uni.showToast( {\n\t\t\t\ttitle: '反馈内容至少10个字',\n\t\t\t\ticon: 'none'\n\t\t\t} )\n\t\t}\n\n\t\t// 验证联系方式格式（如果填写了的话）\n\t\tif ( contactInfo.value ) {\n\t\t\tconst phoneReg = /^1[3-9]\\d{9}$/\n\t\t\tconst emailReg = /^[\\w-]+(\\.[\\w-]+)*@[\\w-]+(\\.[\\w-]+)+$/\n\t\t\tif ( !phoneReg.test( contactInfo.value ) && !emailReg.test( contactInfo.value ) ) {\n\t\t\t\treturn uni.showToast( {\n\t\t\t\t\ttitle: '请输入正确的手机号或邮箱',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t} )\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tisSubmitting.value = true\n\t\t\tuni.showLoading( {\n\t\t\t\ttitle: '提交中...',\n\t\t\t\tmask: true\n\t\t\t} )\n\n\t\t\tconst feedbackApi = uniCloud.importObject( 'feedback' )\n\t\t\tconst res = await feedbackApi.add( {\n\t\t\t\ttype: selectedType.value,\n\t\t\t\tcontent: feedbackContent.value,\n\t\t\t\tcontact: contactInfo.value,\n\t\t\t\timages: imageValue.value,\n\t\t\t\tuser_id: userStore.userInfo.uid\n\t\t\t} )\n\n\t\t\tif ( res.success ) {\n\t\t\t\tuni.hideLoading( )\n\t\t\t\tuni.showToast( {\n\t\t\t\t\ttitle: '提交成功',\n\t\t\t\t\ticon: 'success'\n\t\t\t\t} )\n\t\t\t\t// 延迟返回\n\t\t\t\tsetTimeout( ( ) => {\n\t\t\t\t\tuni.navigateBack( )\n\t\t\t\t}, 1500 )\n\t\t\t}\n\t\t} catch ( err ) {\n\t\t\tuni.hideLoading( )\n\t\t\tuni.showToast( {\n\t\t\t\ttitle: err.message || '提交失败',\n\t\t\t\ticon: 'none'\n\t\t\t} )\n\t\t} finally {\n\t\t\tisSubmitting.value = false\n\t\t}\n\t}\n\n\t// 删除图片\n\tconst deleteImage = ( index ) => {\n\t\timageValue.value = imageValue.value.filter( ( _, i ) => i !== index )\n\t}\n</script>\n\n<template>\n\t<!-- 整体容器 -->\n\t<view class=\"feedback-container\">\n\t\t<!-- 反馈表单卡片 -->\n\t\t<view class=\"feedback-card\">\n\t\t\t<!-- 标题区域 -->\n\t\t\t<view class=\"feedback-header\">\n\t\t\t\t<text class=\"feedback-title\">意见反馈</text>\n\t\t\t\t<text class=\"feedback-desc\">您的建议是我们进步的动力</text>\n\t\t\t</view>\n\n\t\t\t<!-- 反馈内容区域 -->\n\t\t\t<view class=\"feedback-section\">\n\t\t\t\t<!-- 反馈类型选择 -->\n\t\t\t\t<view class=\"feedback-item\">\n\t\t\t\t\t<text class=\"label\">反馈类型</text>\n\t\t\t\t\t<view class=\"type-group\">\n\t\t\t\t\t\t<text v-for=\"type in feedbackTypes\" :key=\"type\" class=\"type-tag\"\n\t\t\t\t\t\t\t:class=\"{ active: selectedType === type }\" @click=\"selectType(type)\">\n\t\t\t\t\t\t\t{{ type }}\n\t\t\t\t\t\t</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\n\t\t\t\t<!-- 反馈内容输入 -->\n\t\t\t\t<view class=\"feedback-item\">\n\t\t\t\t\t<text class=\"label\">反馈内容</text>\n\t\t\t\t\t<up-textarea v-model=\"feedbackContent\" placeholder=\"请详细描述您的问题或建议（最少10字）\"\n\t\t\t\t\t\tcount></up-textarea>\n\t\t\t\t</view>\n\n\t\t\t\t<!-- 联系方式 -->\n\t\t\t\t<view class=\"feedback-item\">\n\t\t\t\t\t<text class=\"label\">联系方式（选填）</text>\n\t\t\t\t\t<input class=\"contact-input\" v-model=\"contactInfo\" placeholder=\"请留下您的手机号或邮箱\"\n\t\t\t\t\t\tplaceholder-style=\"padding: 0 32rpx;\" placeholder-class=\"placeholder-style\" />\n\t\t\t\t</view>\n\n\t\t\t\t<!-- 图片上传区域 -->\n\t\t\t\t<view class=\"feedback-item\">\n\t\t\t\t\t<text class=\"label\">上传图片（选填，最多3张）</text>\n\t\t\t\t\t<uni-file-picker v-model=\"imageValue\" fileMediatype=\"image\" mode=\"grid\" :limit=\"3\"\n\t\t\t\t\t\t@success=\"success\" @fail=\"fail\" @delete=\"deleteImage\" :image-styles=\"{\n\t\t\t\t\t\t\twidth: 200,\n\t\t\t\t\t\t\theight: 200\n\t\t\t\t\t\t}\" />\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<!-- 提交按钮 -->\n\t\t\t<button class=\"submit-btn\" @click=\"submitFeedback\" :disabled=\"isSubmitting\">\n\t\t\t\t{{ isSubmitting ? '提交中...' : '提交反馈' }}\n\t\t\t</button>\n\t\t</view>\n\t</view>\n</template>\n\n<style lang=\"scss\" scoped>\n\t/* 页面整体容器样式 */\n\t.feedback-container {\n\t\tpadding: 24rpx 24rpx 160rpx 24rpx;\n\t\tbackground-color: #f5f7fa;\n\t\tmin-height: 100vh;\n\t}\n\n\t/* 反馈表单卡片样式 */\n\t.feedback-card {\n\t\tbackground-color: #ffffff;\n\t\tborder-radius: 24rpx;\n\t\tpadding: 48rpx;\n\t\tbox-shadow: 0 4rpx 24rpx rgba(0, 0, 0, 0.05);\n\t}\n\n\t/* 标题区域样式 */\n\t.feedback-header {\n\t\ttext-align: center;\n\t\tmargin-bottom: 64rpx;\n\t\tpadding-bottom: 40rpx;\n\t\tborder-bottom: 2rpx solid $pyq-text-color-placeholder;\n\n\t\t.feedback-title {\n\t\t\tdisplay: block;\n\t\t\tfont-size: 48rpx;\n\t\t\tfont-weight: 600;\n\t\t\tcolor: $pyq-text-color-body;\n\t\t\tmargin-bottom: 16rpx;\n\t\t}\n\n\t\t.feedback-desc {\n\t\t\tfont-size: 28rpx;\n\t\t\tcolor: $pyq-text-color-body-secondary;\n\t\t}\n\t}\n\n\t/* 反馈内容区域样式 */\n\t.feedback-section {\n\t\t.feedback-item {\n\t\t\tmargin-bottom: 48rpx;\n\n\t\t\t.label {\n\t\t\t\tdisplay: block;\n\t\t\t\tfont-size: 32rpx;\n\t\t\t\tcolor: $pyq-text-color-body-secondary;\n\t\t\t\tmargin-bottom: 24rpx;\n\t\t\t}\n\n\t\t\t/* 反馈类型标签组 */\n\t\t\t.type-group {\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-wrap: wrap;\n\t\t\t\tgap: 24rpx;\n\n\t\t\t\t.type-tag {\n\t\t\t\t\tpadding: 16rpx 32rpx;\n\t\t\t\t\tborder-radius: 32rpx;\n\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t\tcolor: $pyq-text-color-body-secondary;\n\t\t\t\t\tbackground-color: #f5f7fa;\n\t\t\t\t\tborder: 2rpx solid transparent;\n\n\t\t\t\t\t&.active {\n\t\t\t\t\t\tcolor: #399bfe;\n\t\t\t\t\t\tbackground-color: rgba(57, 155, 254, 0.1);\n\t\t\t\t\t\tborder-color: #399bfe;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* 文本域样式 */\n\t\t\t.feedback-textarea {\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 240rpx;\n\t\t\t\tpadding: 24rpx !important;\n\t\t\t\tborder-radius: 16rpx;\n\t\t\t\tbackground-color: #f5f7fa;\n\t\t\t\tfont-size: 28rpx;\n\t\t\t\tcolor: $pyq-text-color-body;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t}\n\n\t\t\t/* 输入框样式 */\n\t\t\t.contact-input {\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 88rpx;\n\t\t\t\tpadding: 0 24rpx !important;\n\t\t\t\tborder-radius: 16rpx;\n\t\t\t\tbackground-color: #f5f7fa;\n\t\t\t\tfont-size: 28rpx;\n\t\t\t\tcolor: $pyq-text-color-body;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t}\n\t\t}\n\t}\n\n\t/* 提交按钮样式 */\n\t.submit-btn {\n\t\tmargin-top: 48rpx;\n\t\twidth: 100%;\n\t\theight: 88rpx;\n\t\tbackground-color: #399bfe;\n\t\tcolor: #ffffff;\n\t\tfont-size: 32rpx;\n\t\tborder-radius: 44rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tborder: none;\n\n\t\t&[disabled] {\n\t\t\topacity: 0.6;\n\t\t\tcursor: not-allowed;\n\t\t}\n\n\t\t&:active {\n\t\t\topacity: 0.8;\n\t\t}\n\t}\n\n\t/* placeholder样式 */\n\t.placeholder-style {\n\t\tcolor: $pyq-text-color-placeholder;\n\t\tfont-size: 28rpx;\n\t\tpadding: 24rpx;\n\t}\n</style>","import MiniProgramPage from 'D:/代码测试/wx2/subPages/feedBack/feedBack.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","useUserInfoStore","uni","testLogin","uniCloud"],"mappings":";;;;;;;;;;;;;;;;AAMC,UAAM,kBAAkBA,cAAG,IAAE,EAAI;AAEjC,UAAM,aAAaA,cAAG,IAAE,EAAK;AAE7B,UAAM,eAAeA,cAAG,IAAE,MAAQ;AAElC,UAAM,cAAcA,cAAG,IAAE,EAAI;AAE7B,UAAM,YAAYC,WAAAA,iBAAmB;AAErC,UAAM,gBAAgB,CAAE,QAAQ,QAAQ,QAAQ,IAAM;AAEtD,UAAM,eAAeD,cAAG,IAAE,KAAO;AAGjC,UAAM,aAAa,CAAE,SAAU;AAC9B,mBAAa,QAAQ;AAAA,IACrB;AAGD,UAAM,UAAU,CAAE,MAAO;AACxB,YAAM,EAAE,UAAS,IAAK;AACtB,iBAAW,QAAQ;AACnBE,oBAAAA,MAAI,UAAW;AAAA,QACd,OAAO;AAAA,QACP,MAAM;AAAA,MACT,CAAK;AAAA,IACH;AAGD,UAAM,OAAO,CAAE,MAAO;AACrBA,oBAAAA,MAAA,MAAA,SAAA,wCAAe,SAAS,CAAG;AAC3BA,oBAAAA,MAAI,UAAW;AAAA,QACd,OAAO;AAAA,QACP,MAAM;AAAA,MACT,CAAK;AAAA,IACH;AAGD,UAAM,iBAAiB,YAAa;AAEnC,UAAK,CAAC,UAAU,SAAS,SAAU;AAClC,eAAOC,wBAAY;AAAA,MACnB;AAGD,UAAK,aAAa;AAAQ;AAG1B,UAAK,gBAAgB,MAAM,SAAS,IAAK;AACxC,eAAOD,cAAAA,MAAI,UAAW;AAAA,UACrB,OAAO;AAAA,UACP,MAAM;AAAA,QACV,CAAM;AAAA,MACH;AAGD,UAAK,YAAY,OAAQ;AACxB,cAAM,WAAW;AACjB,cAAM,WAAW;AACjB,YAAK,CAAC,SAAS,KAAM,YAAY,KAAK,KAAM,CAAC,SAAS,KAAM,YAAY,QAAU;AACjF,iBAAOA,cAAAA,MAAI,UAAW;AAAA,YACrB,OAAO;AAAA,YACP,MAAM;AAAA,UACX,CAAO;AAAA,QACH;AAAA,MACD;AAED,UAAI;AACH,qBAAa,QAAQ;AACrBA,sBAAAA,MAAI,YAAa;AAAA,UAChB,OAAO;AAAA,UACP,MAAM;AAAA,QACV,CAAM;AAEH,cAAM,cAAcE,cAAAA,GAAS,aAAc,UAAY;AACvD,cAAM,MAAM,MAAM,YAAY,IAAK;AAAA,UAClC,MAAM,aAAa;AAAA,UACnB,SAAS,gBAAgB;AAAA,UACzB,SAAS,YAAY;AAAA,UACrB,QAAQ,WAAW;AAAA,UACnB,SAAS,UAAU,SAAS;AAAA,QAChC,CAAM;AAEH,YAAK,IAAI,SAAU;AAClBF,wBAAAA,MAAI,YAAc;AAClBA,wBAAAA,MAAI,UAAW;AAAA,YACd,OAAO;AAAA,YACP,MAAM;AAAA,UACX,CAAO;AAEH,qBAAY,MAAO;AAClBA,0BAAAA,MAAI,aAAe;AAAA,UACnB,GAAE,IAAM;AAAA,QACT;AAAA,MACD,SAAS,KAAM;AACfA,sBAAAA,MAAI,YAAc;AAClBA,sBAAAA,MAAI,UAAW;AAAA,UACd,OAAO,IAAI,WAAW;AAAA,UACtB,MAAM;AAAA,QACV,CAAM;AAAA,MACN,UAAY;AACT,qBAAa,QAAQ;AAAA,MACrB;AAAA,IACD;AAGD,UAAM,cAAc,CAAE,UAAW;AAChC,iBAAW,QAAQ,WAAW,MAAM,OAAQ,CAAE,GAAG,MAAO,MAAM,KAAO;AAAA,IACrE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClHF,GAAG,WAAW,eAAe;"}
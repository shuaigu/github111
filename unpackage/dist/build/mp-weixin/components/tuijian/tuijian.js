"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/formatTime.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-load-more"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js"))();const t={__name:"tuijian",props:{currentArticleId:{type:String,required:!0},cate_id:{type:String,default:""}},emits:["click"],setup(t,{expose:n,emit:i}){const o=t,r=i,c=e.ref([]),s=e.ref(1),l=e.ref(8),u=e.ref(!1),m=e.ref("more"),d=e.nr.importObject("articleWx",{customUI:!0}),g=e.nr.importObject("cateWx",{customUI:!0}),f=async(e=!1)=>{try{e&&(s.value=1,m.value="loading"),u.value=!0;const a=await d.getArticle(o.cate_id||"01",s.value,l.value);if(0!==a.code||!a.data)throw new Error(a.message||"获取更多文章失败");{const t=a.data.filter((e=>e._id!==o.currentArticleId)),n=await Promise.all(t.map((async e=>(e.cate_name||(e.cate_name=await(async e=>{try{if(!e)return"未分类";const a=await g.get(e);return a.data&&a.data[0]?a.data[0].cate_name:"未分类"}catch(a){return console.error("获取分类名称失败:",a),"未分类"}})(e.cate_id)),e.images&&0!==e.images.length||(e.category_image=await(async e=>{try{if(!e)return"/static/images/default-image.png";const a=await g.get(e);return a.data&&a.data[0]&&a.data[0].cate_img?a.data[0].cate_img:"/static/images/default-image.png"}catch(a){return console.error("获取分类图片失败:",a),"/static/images/default-image.png"}})(e.cate_id)),e))));e||1===s.value?c.value=n:c.value=[...c.value,...n],0===t.length||t.length<l.value&&s.value>1?m.value="noMore":m.value="more"}}catch(a){console.error("获取更多文章失败:",a),m.value="more"}finally{u.value=!1}};return e.watch((()=>o.cate_id),((e,a)=>{e!==a&&f(!0)})),e.onMounted((()=>{f(!0)})),n({loadMore:async()=>{u.value||"noMore"===m.value||(s.value++,await f(!1))},refresh:()=>f(!0)}),(n,i)=>e.e({a:e.t(t.cate_id?"相关推荐":"更多文章"),b:c.value.length>0},c.value.length>0?{c:e.f(c.value,((t,n,i)=>e.e({a:t.images&&t.images.length?t.images[0].compressedURL:t.category_image||"/static/images/default-image.png",b:e.o((a=>t.images&&t.images.length?(a=>{if(!a||!a.length)return;const t=a.map((e=>e.compressedURL));e.index.previewImage({current:t[0],urls:t,indicator:"number",loop:!0,fail:a=>{console.error("预览图片失败:",a),e.index.showToast({title:"预览图片失败",icon:"none"})}})})(t.images):null),t._id),c:t.images&&t.images.length>1},t.images&&t.images.length>1?{d:"fc47edea-0-"+i,e:e.p({type:"image",size:"12",color:"#fff"}),f:e.t(t.images.length)}:{},{g:e.t(t.cate_name||"未分类"),h:e.t(t.content),i:e.t(e.unref(a.formatTime)(t.create_time)),j:e.t(t.look_count||0),k:t._id,l:e.o((e=>{return a=t._id,void r("click",a);var a}),t._id)})))}:{},{d:e.p({status:u.value?"loading":m.value,contentText:{contentdown:"上拉加载更多",contentrefresh:"加载中...",contentnomore:t.cate_id?"没有更多相关文章了":"没有更多文章了"},iconType:"auto",color:"#cccccc"}),e:e.gei(n,"")})}},n=e._export_sfc(t,[["__scopeId","data-v-fc47edea"]]);wx.createComponent(n);

"use strict";const e=require("../../common/vendor.js"),o=require("../../store/user.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const n={__name:"my",setup(n){const i=o.useUserInfoStore(),r=e.nr.importObject("userWx",{customUI:!0}),t=async()=>{e.index.navigateTo({url:"/pages/login/login"})},s=async o=>{const{avatarUrl:n}=o.detail;if(n)try{await c(n)}catch(i){console.error("更新头像失败:",i),e.index.showToast({title:i.message||"头像更新失败",icon:"none"})}},c=async o=>{e.index.showLoading({title:"更新头像中..."});try{const n=await e.nr.uploadFile({filePath:o,cloudPath:`avatar/${i.userInfo.uid}_${Date.now()}.jpg`});if(!n.fileID)throw new Error("头像上传失败");const t=await r.updateUserProfile({uid:i.userInfo.uid,avatarUrl:n.fileID});if(0!==t.code)throw new Error(t.message||"头像更新失败");i.updateUserAvatar(n.fileID),e.index.showToast({title:"头像更新成功",icon:"success"})}finally{e.index.hideLoading()}},a=e=>{const o=e.detail.value;o&&o!==i.userInfo.nickName&&u(o)},u=async o=>{try{e.index.showLoading({title:"更新昵称中..."});const n=await r.updateUserProfile({uid:i.userInfo.uid,nickName:o});if(0!==n.code)throw new Error(n.message||"昵称更新失败");i.updateUserNickName(o),e.index.showToast({title:"昵称更新成功",icon:"success"})}catch(n){console.error("更新昵称失败:",n),e.index.showToast({title:n.message||"昵称更新失败",icon:"none"})}finally{e.index.hideLoading()}},f=()=>{e.index.navigateTo({url:"/subPages/contarct/contarct"})},l=()=>{e.index.navigateTo({url:"/subPages/feedBack/feedBack"})},d=e.computed((()=>"admin"===i.userInfo.role[0])),p=()=>{if(d.value)try{e.index.navigateTo({url:"/subPages/adminManage/adminManage",fail:o=>{console.error("跳转到管理页面失败:",o),e.index.showToast({title:"页面不存在或配置错误",icon:"none",duration:2e3})}})}catch(o){console.error("导航异常:",o),e.index.showToast({title:"跳转异常，请重试",icon:"none",duration:2e3})}else e.index.showToast({title:"您没有管理员权限",icon:"none",duration:2e3})},g=e.computed((()=>{if(!i.userInfo.mobile)return"";const e=i.userInfo.mobile;return 11!==e.length?e:e.substring(0,3)+"****"+e.substring(7)}));e.onMounted((()=>{i.userInfo.uid}));const m=()=>{e.index.showModal({title:"提示",content:"确定要退出登录吗",success(e){e.confirm&&i.cleanUserInfo()}})};return(o,n)=>e.e({a:e.unref(i).userInfo.avatarUrl,b:e.unref(i).userInfo.isLogin},e.unref(i).userInfo.isLogin?{c:e.p({type:"camera-filled",color:"#fff",size:"20"})}:{},{d:e.o(s),e:e.unref(i).userInfo.isLogin},e.unref(i).userInfo.isLogin?{f:e.o(a),g:e.unref(i).userInfo.nickName,h:e.t(g.value)}:{i:e.o(t)},{j:e.p({color:"#46b0fe",type:"wallet",size:"22"}),k:e.p({color:"#cccccc","custom-prefix":"iconfont",type:"icon-arrow-drop-right-line",size:"30"}),l:e.o(f),m:e.p({color:"#46b0fe","custom-prefix":"iconfont",type:"icon-yijianfankui",size:"22"}),n:e.p({color:"#cccccc","custom-prefix":"iconfont",type:"icon-arrow-drop-right-line",size:"30"}),o:e.o(l),p:"admin"==e.unref(i).userInfo.role[0]},"admin"==e.unref(i).userInfo.role[0]?{q:e.p({color:"#46b0fe","custom-prefix":"iconfont",type:"icon-houtaiguanli",size:"22"}),r:e.p({color:"#cccccc","custom-prefix":"iconfont",type:"icon-arrow-drop-right-line",size:"30"}),s:e.o(p)}:{},{t:e.unref(i).userInfo.isLogin},e.unref(i).userInfo.isLogin?{v:e.p({color:"#ff6b6b","custom-prefix":"iconfont",type:"icon-tuichudenglu",size:"22"}),w:e.p({color:"#cccccc","custom-prefix":"iconfont",type:"icon-arrow-drop-right-line",size:"30"}),x:e.o(m)}:{},{y:e.gei(o,"")})}},i=e._export_sfc(n,[["__scopeId","data-v-e1712751"]]);wx.createPage(i);

"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/formatTime.js"),a=require("../../store/user.js"),i={__name:"articleManage",setup(i){const s=a.useUserInfoStore(),n=e.nr.importObject("articleWx",{customUI:!0}),o=e.ref([]),d=e.ref({pending:0,approved:0,rejected:0}),c=e.ref("0"),r=async()=>{try{const e={state:Number(c.value)},a=await n.getAdminArticles(e);o.value=a.data.map((e=>({...e,create_time:t.formatTime(e.create_time)}))),d.value=a.stats}catch(a){e.index.showToast({title:a.message||"获取文章列表失败",icon:"none"})}},l=e=>{c.value=e,r()},m=async(t,a)=>{try{e.index.showLoading({title:"处理中..."}),await n.updateState(t,a),e.index.hideLoading(),e.index.showToast({title:1===a?"已通过":"已拒绝",icon:"success"}),r()}catch(i){e.index.hideLoading(),e.index.showToast({title:i.message||"操作失败",icon:"none"})}},g=()=>{e.index.switchTab({url:"/pages/index/index"})},u=(t,a)=>{e.index.previewImage({urls:t,current:a})};return e.onMounted((()=>{r()})),(t,a)=>({a:e.t(d.value.pending),b:e.t(d.value.approved),c:e.t(d.value.rejected),d:"0"===c.value?1:"",e:e.o((e=>l("0"))),f:"1"===c.value?1:"",g:e.o((e=>l("1"))),h:"2"===c.value?1:"",i:e.o((e=>l("2"))),j:e.f(o.value,((t,a,i)=>e.e({a:e.t(t.content),b:t.images&&t.images.length},t.images&&t.images.length?e.e({c:1===t.images.length},1===t.images.length?{d:t.images[0]+"?thumbnailURL",e:e.o((e=>u(t.images,t.images[0])),t._id)}:{f:e.f(t.images,((a,i,s)=>({a:a+"?thumbnailURL",b:e.o((e=>u(t.images,a)),i),c:i})))}):{},{g:e.t(t.create_time),h:e.t(0===t.state?"待审核":1===t.state?"已通过":"已拒绝"),i:0===t.state?1:"",j:1===t.state?1:"",k:2===t.state?1:"",l:0===t.state},0===t.state?{m:e.o((e=>m(t._id,1)),t._id)}:{},{n:0===t.state},0===t.state?{o:e.o((e=>m(t._id,2)),t._id)}:{},{p:e.o((a=>(async t=>{e.index.showModal({title:"提示",content:"确定要删除这篇文章吗？",async success(a){if(a.confirm)try{e.index.showLoading({title:"删除中..."}),await n.adminDelete(t,s.userInfo.role[0]),e.index.hideLoading(),e.index.showToast({title:"删除成功",icon:"success"}),r()}catch(i){e.index.hideLoading(),e.index.showToast({title:i.message||"删除失败",icon:"none"})}}})})(t._id)),t._id),q:t._id}))),k:e.o(g),l:e.gei(t,"")})}},s=e._export_sfc(i,[["__scopeId","data-v-f34dfd62"]]);wx.createPage(s);

"use strict";const e=require("../../common/vendor.js"),t=require("../../store/user.js"),o=require("../../utils/isLogin.js");if(!Array){(e.resolveComponent("up-textarea")+e.resolveComponent("uni-file-picker"))()}Math;const i={__name:"feedBack",setup(i){const a=e.ref(""),s=e.ref([]),n=e.ref("功能建议"),l=e.ref(""),u=t.useUserInfoStore(),r=["功能建议","界面设计","性能问题","其他"],c=e.ref(!1),d=t=>{const{tempFiles:o}=t;s.value=o,e.index.showToast({title:"上传成功",icon:"success"})},v=t=>{console.error("上传失败:",t),e.index.showToast({title:"上传失败",icon:"error"})},f=async()=>{if(!u.userInfo.isLogin)return o.testLogin();if(!c.value){if(a.value.length<10)return e.index.showToast({title:"反馈内容至少10个字",icon:"none"});if(l.value){const t=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;if(!/^1[3-9]\d{9}$/.test(l.value)&&!t.test(l.value))return e.index.showToast({title:"请输入正确的手机号或邮箱",icon:"none"})}try{c.value=!0,e.index.showLoading({title:"提交中...",mask:!0});const t=e.nr.importObject("feedback");(await t.add({type:n.value,content:a.value,contact:l.value,images:s.value,user_id:u.userInfo.uid})).success&&(e.index.hideLoading(),e.index.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),1500))}catch(t){e.index.hideLoading(),e.index.showToast({title:t.message||"提交失败",icon:"none"})}finally{c.value=!1}}},m=e=>{s.value=s.value.filter(((t,o)=>o!==e))};return(t,o)=>({a:e.f(r,((t,o,i)=>({a:e.t(t),b:t,c:n.value===t?1:"",d:e.o((e=>(e=>{n.value=e})(t)),t)}))),b:e.o((e=>a.value=e)),c:e.p({placeholder:"请详细描述您的问题或建议（最少10字）",count:!0,modelValue:a.value}),d:l.value,e:e.o((e=>l.value=e.detail.value)),f:e.o(d),g:e.o(v),h:e.o(m),i:e.o((e=>s.value=e)),j:e.p({fileMediatype:"image",mode:"grid",limit:3,"image-styles":{width:200,height:200},modelValue:s.value}),k:e.t(c.value?"提交中...":"提交反馈"),l:e.o(f),m:c.value,n:e.gei(t,"")})}},a=e._export_sfc(i,[["__scopeId","data-v-0754e22f"]]);wx.createPage(a);

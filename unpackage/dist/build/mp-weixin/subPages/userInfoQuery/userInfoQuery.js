"use strict";const e=require("../../common/vendor.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const a={__name:"userInfoQuery",setup(a){const i=e.reactive({mobile:"",nickName:""}),o=e.ref([]),l=e.ref(!1),t=e.ref(!0),n=e.ref(1),s=[{id:"user",name:"普通用户",description:"基础用户权限"},{id:"admin",name:"管理员",description:"拥有系统管理权限"},{id:"vip",name:"VIP用户",description:"拥有特殊内容访问权限"},{id:"editor",name:"编辑",description:"可以编辑和发布内容"}],r=e.nr.importObject("user",{customUI:!0}),u=async()=>{if(i.mobile||i.nickName)try{l.value=!0,n.value=1;const a=await r.queryUsers({...i,page:n.value,pageSize:10});o.value=a.data.map((e=>v(e))),t.value=a.data.length>=10,0===o.value.length&&e.index.showToast({title:"未找到匹配的用户",icon:"none"})}catch(a){e.index.showToast({title:"查询失败: "+a.message,icon:"none"})}finally{l.value=!1}else e.index.showToast({title:"请输入手机号或昵称",icon:"none"})},d=()=>{i.mobile="",i.nickName="",o.value=[],n.value=1,t.value=!0},c=(e,a)=>e.role&&e.role.includes(a),v=e=>(e.role?e.role.includes("user")||e.role.push("user"):e.role=["user"],e);return(a,n)=>e.e({a:i.mobile,b:e.o((e=>i.mobile=e.detail.value)),c:i.nickName,d:e.o((e=>i.nickName=e.detail.value)),e:e.o(u),f:e.o(d),g:0===o.value.length&&!l.value},(0!==o.value.length||l.value,{}),{h:e.f(o.value,((a,i,o)=>({a:a.avatarUrl||"/static/default-avatar.png",b:e.t(a.nickName||"未设置昵称"),c:e.t(a.mobile),d:e.t(0===a.status?"正常":1===a.status?"禁用":"封禁"),e:0===a.status?1:"",f:1===a.status?1:"",g:2===a.status?1:"",h:e.f(s,((i,o,l)=>({a:e.t(i.name),b:i.id,c:c(a,i.id)?1:"",d:e.o((o=>(async(a,i,o)=>{var l;if(o.stopPropagation(),"user"===i&&a.role&&a.role.includes("user"))e.index.showToast({title:"不能移除普通用户角色",icon:"none"});else try{e.index.showLoading({title:"处理中..."});const o=a.role&&a.role.includes(i),t=(null==(l=s.find((e=>e.id===i)))?void 0:l.name)||i;if(await r.updateUserRole({userId:a._id,action:o?"remove":"add",role:i}),o){const e=a.role.indexOf(i);a.role.splice(e,1)}else a.role||(a.role=[]),a.role.push(i);e.index.showToast({title:o?`已移除${t}权限`:`已设为${t}`,icon:"success"})}catch(t){e.index.showToast({title:"操作失败: "+t.message,icon:"none"})}finally{e.index.hideLoading()}})(a,i.id,o)),i.id)}))),i:"729a2ad2-0-"+o,j:e.o((i=>(a=>{e.index.navigateTo({url:`/subPages/userRoleManage/userRoleManage?id=${a._id}`})})(a)),i),k:"729a2ad2-1-"+o,l:i,m:e.o((i=>(a=>{e.index.navigateTo({url:`/subPages/userDetail/userDetail?id=${a._id}`})})(a)),i)}))),i:e.p({type:"more-filled",size:"18",color:"#999"}),j:e.p({type:"right",size:"20",color:"#CCCCCC"}),k:l.value},(l.value,{}),{l:!t.value&&o.value.length>0},(!t.value&&o.value.length,{}),{m:e.gei(a,"")})}},i=e._export_sfc(a,[["__scopeId","data-v-729a2ad2"]]);wx.createPage(i);

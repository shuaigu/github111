"use strict";const e=require("../../common/vendor.js"),a={__name:"userDetail",setup(a){const t=e.ref(""),o=e.ref(null),l=e.ref(!0),s=e.ref(!0),n=e.ref(0),i=[{id:"admin",name:"管理员",description:"拥有系统管理权限"},{id:"vip",name:"VIP用户",description:"拥有特殊内容访问权限"},{id:"editor",name:"编辑",description:"可以编辑和发布内容"},{id:"reviewer",name:"审核员",description:"可以审核内容"},{id:"customer",name:"客服",description:"处理用户反馈"},{id:"user",name:"普通用户",description:"基础用户权限"}],u=e.nr.importObject("user",{customUI:!0}),r=async()=>{try{l.value=!0;const e=await u.getUserById(t.value);o.value=e.data,o.value.role?o.value.role.includes("user")||o.value.role.push("user"):o.value.role=["user"]}catch(a){e.index.showToast({title:"获取用户信息失败: "+a.message,icon:"none"})}finally{l.value=!1}},v=async a=>{try{e.index.showLoading({title:"更新中..."}),await u.updateUserStatus({userId:t.value,status:a}),e.index.showToast({title:"状态更新成功",icon:"success"}),r()}catch(o){e.index.showToast({title:"更新失败: "+o.message,icon:"none"})}finally{e.index.hideLoading()}},d=e=>{const a=i.find((a=>a.id===e));return a?a.name:e},c=()=>{if(t.value){console.log("跳转到角色管理页面，用户ID:",t.value);try{e.index.setStorageSync("CURRENT_MANAGE_USER_ID",t.value),console.log("用户ID已保存到本地存储:",t.value)}catch(a){console.error("保存用户ID到本地存储失败:",a)}e.index.navigateTo({url:"/subPages/userRoleManage/userRoleManage",success:()=>{console.log("成功跳转到角色管理页面")},fail:a=>{console.error("跳转失败:",a),e.index.showToast({title:"页面跳转失败",icon:"none"})}})}else e.index.showToast({title:"用户ID不存在，无法管理角色",icon:"none"})};return e.onMounted((()=>{var a,o,l;e.index.getSystemInfo({success:e=>{n.value=e.windowHeight}});const s=getCurrentPages(),i=s[s.length-1];let u="";if(null==(o=null==(a=i.$page)?void 0:a.options)?void 0:o.id)u=i.$page.options.id;else if(null==(l=i.options)?void 0:l.id)u=i.options.id;else{const a=e.index.getStorageSync("CURRENT_USER_ID");a&&(u=a,e.index.removeStorageSync("CURRENT_USER_ID"))}u?(t.value=u,r()):(e.index.showToast({title:"用户ID不存在",icon:"none"}),setTimeout((()=>{e.index.navigateBack()}),1500))})),(a,t)=>e.e({a:l.value},l.value?{}:o.value?e.e({c:o.value.avatarUrl||"/static/default-avatar.png",d:e.t(o.value.nickName||"未设置昵称"),e:e.t(0===o.value.status?"正常":1===o.value.status?"禁用":"封禁"),f:0===o.value.status?1:"",g:1===o.value.status?1:"",h:2===o.value.status?1:"",i:e.t(o.value._id),j:e.t(o.value.mobile),k:e.t(1===o.value.gender?"男":2===o.value.gender?"女":"未知"),l:e.t(o.value.role?o.value.role.join(", "):"无"),m:e.t(new Date(o.value.create_time).toLocaleString()),n:e.t(new Date(o.value.update_time).toLocaleString()),o:e.o(c),p:o.value.role&&o.value.role.length>0},o.value.role&&o.value.role.length>0?{q:e.f(o.value.role,((a,t,o)=>({a:e.t(d(a)),b:a})))}:{},{r:e.t(o.value.openid_wx||"未绑定"),s:e.t(o.value.openid_ds||"未绑定"),t:e.t(o.value.openid_ks||"未绑定"),v:0===o.value.status?1:"",w:e.o((e=>0!==o.value.status&&v(0))),x:1===o.value.status?1:"",y:e.o((e=>1!==o.value.status&&v(1))),z:2===o.value.status?1:"",A:e.o((e=>2!==o.value.status&&v(2)))}):{},{b:o.value,B:n.value+"px",C:"overflow:"+(s.value?"auto":"hidden"),D:e.gei(a,"")})}},t=e._export_sfc(a,[["__scopeId","data-v-b70f7c8e"]]);wx.createPage(t);

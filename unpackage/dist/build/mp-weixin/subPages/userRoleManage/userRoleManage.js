"use strict";const e=require("../../common/vendor.js");if(!Array){e.resolveComponent("uni-load-more")()}Math;const a={__name:"userRoleManage",setup(a){const i=e.ref(""),o=e.ref(null),n=e.ref(!0),t=e.ref([{id:"admin",name:"管理员",description:"拥有系统管理权限"},{id:"vip",name:"VIP用户",description:"拥有特殊内容访问权限"},{id:"editor",name:"编辑",description:"可以编辑和发布内容"},{id:"reviewer",name:"审核员",description:"可以审核内容"},{id:"customer",name:"客服",description:"处理用户反馈"},{id:"user",name:"普通用户",description:"基础用户权限"}]),l=e.nr.importObject("user",{customUI:!0}),s=e=>o.value&&o.value.role&&o.value.role.includes(e);return e.onMounted((()=>{var a;const t=getCurrentPages(),s=null==(a=t[t.length-1].$page)?void 0:a.options;s&&s.id?(i.value=s.id,(async()=>{try{n.value=!0;const e=await l.getUserById(i.value);o.value=e.data,o.value.role?o.value.role.includes("user")||o.value.role.push("user"):o.value.role=["user"]}catch(a){e.index.showToast({title:"获取用户信息失败: "+a.message,icon:"none"})}finally{n.value=!1}})()):(e.index.showToast({title:"用户ID不存在",icon:"none"}),setTimeout((()=>{e.index.navigateBack()}),1500))})),(a,r)=>e.e({a:n.value},n.value?{b:e.p({status:"loading",contentText:{contentdown:"加载中..."}})}:o.value?{d:o.value.avatarUrl||"/static/default-avatar.png",e:e.t(o.value.nickName||"未设置昵称"),f:e.t(o.value.mobile),g:e.f(t.value,((a,n,t)=>e.e({a:e.t(a.name),b:e.t(a.description),c:"user"===a.id},(a.id,{}),{d:s(a.id),e:e.o((n=>(async a=>{if("user"===a&&o.value.role&&o.value.role.includes("user"))e.index.showToast({title:"不能移除普通用户角色",icon:"none"});else try{e.index.showLoading({title:"处理中..."});const n=o.value.role&&o.value.role.includes(a);if(await l.updateUserRole({userId:i.value,action:n?"remove":"add",role:a}),n){const e=o.value.role.indexOf(a);o.value.role.splice(e,1)}else o.value.role||(o.value.role=[]),o.value.role.push(a);e.index.showToast({title:n?"已移除角色":"已添加角色",icon:"success"})}catch(n){e.index.showToast({title:"操作失败: "+n.message,icon:"none"})}finally{e.index.hideLoading()}})(a.id)),a.id),f:"user"===a.id&&s("user"),g:"user"===a.id&&s("user")?1:"",h:a.id,i:"user"===a.id?1:""})))}:{},{c:o.value,h:e.gei(a,"")})}},i=e._export_sfc(a,[["__scopeId","data-v-9ad11a6a"]]);wx.createPage(i);
